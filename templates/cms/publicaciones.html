{% load static %}
{% load custom_filters %}
<link href="{% static 'css/styles.css' %}" rel="stylesheet" />
<link href="{% static 'css/publicaciones.css' %}" rel="stylesheet" />
<div class="contenedor">
  <div class="publicaciones">
    <!-- Agrega el enlace para cargar Font Awesome si no lo has hecho aún -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    {% for publicacion, imagen_autor in publicaciones_con_imagen %}
      <div class="publicacion">
        <!-- Círculo de perfil, nombre del autor y fecha en la misma línea -->
        <div class="perfil-nombre-fecha">
          <div class="perfil-circle">
            {% if imagen_autor %}
              <img src="{{ imagen_autor }}" alt="Foto de perfil" class="rounded-circle" width="33" height="33" style="object-fit: cover; margin-top: -3px;">
            {% else %}
              <i class="fas fa-user"></i> <!-- Icono de persona si no hay foto de perfil -->
            {% endif %}
          </div>
          <!-- Espacio entre la imagen del autor y el nombre -->
          <span class="espacio-i-a"></span>
          <!-- Nombre del autor en negrita -->
          <span class="nombre-autor">{{ publicacion.autor.username }}</span>

          <!-- Espacio entre el nombre del autor y la fecha -->
          <span class="espacio-a-f"></span>
          <!-- Fecha de publicación (dia, mes, año) -->
          <span class="fecha-publicacion">{{ publicacion.fecha_creacion|date:"d, M Y" }}</span>
        </div>
        <!-- Enlace a la publicación completa (vista previa como enlace) -->
        <a href="{% url 'publicaciones:mostrar_publicacion' publicacion.id %}" class="enlace-previa">
          <!-- Vista previa de la publicación (imagen y contenido) -->
          <div class="vista-previa">
            {% with img_url=publicacion.texto|safe|find_image_url %}
            <div class="contenido-previa" {% if img_url %}style="width: 500px;"{% else %}style="width: 700px;"{% endif %}>
            {% endwith %}
              <!-- Título de la publicación -->
              <h2 class="titulo-previa">{{ publicacion.titulo }}</h2>

              <!-- Contenido del medio de la vista previa -->
              <div class="contenido-medio-previa">
                {% spaceless %}
                {{ publicacion.texto|striptags|truncatechars:400 }} <!-- Limita el contenido a 200 caracteres y agrega puntos suspensivos -->
                {% endspaceless %}
              </div>
            </div>
            <div class="imagen-previa">
              {% load custom_filters %} <!-- Cargar los filtros personalizados -->
              {% with publicacion.texto|safe as html_text %}
                {% with img_url=html_text|find_image_url %}
                  {% if img_url %}
                    <img src="{{ img_url }}" alt="Imagen">
                  {% endif %}
                {% endwith %}
              {% endwith %}
            </div>
          </div>
    
        </a>

        <!-- Línea que muestra la categoría y el enlace de reportar -->
        <div class="categoria-y-enlace">
          <!-- Muestra la categoría de la publicación -->
          <span class="categoria-destacada">{{ publicacion.categoria }}</span>
          <!-- Enlace de puntos suspensivos para mostrar la opción de "Reportar" -->
          <div class="dropdown">
            <span class="fas fa-ellipsis-h puntos-suspensivos" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false"></span>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink">
                  <li>
                      <a class="dropdown-item" href="#">Reportar</a>
                  </li>
              </ul>
          </div>
        </div> 

        <hr class="hr">  
      </div>
      
    {% endfor %}

  </div>

  <!-- Barra lateral -->
  <div class="barra-lateral">
    <!-- Categorías recomendadas -->
    <div class="categorias-recomendadas">
      <h3>Categorías Recomendadas</h3>
      <ul>
        <!-- Itera sobre las primeras 8 categorías -->
        {% for publicacion, imagen_autor in publicaciones_con_imagen|slice:":8" %}
          <li>{{ publicacion.categoria }}</li>
        {% endfor %}
      </ul>
    </div>

    <!-- A quién seguir -->
    <div class="a-quien-seguir">
      <h3>A quién seguir</h3>
      <ul>
        <!-- Itera sobre los primeros 3 usuarios -->
        {% for publicacion, imagen_autor in publicaciones_con_imagen|slice:":3" %}
          <li>
            <div class="usuario">
              <!-- Imagen de usuario -->
              <img src="{{ imagen_autor }}" alt="Foto de perfil" width="40" height="40">
              <!-- Nombre de usuario -->
              <span>{{ publicacion.autor.username }}</span>
              <!-- Botón para seguir -->
              <a href="#" class="seguir">Seguir</a>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>

  </div>
  
</div>